#!/bin/sh

#set -aeux

RUNDIR=_RUND_
SRCDIR=_SRCD_

mkdir -p $RUNDIR
cd $RUNDIR
rm -rf $RUNDIR/*

cp _RTPWD_/NMMB_reg/input_nmmb_regional.d01               input_domain_01
cp _RTPWD_/NMMB_reg/input_nmmb_regional.d01_nemsio        input_domain_01_nemsio
cp _RTPWD_/NMMB_reg/nmmb_rst_01_bin_0024h_00m_00.00s  restart_file_01
cp _RTPWD_/NMMB_reg/nmmb_rst_01_nio_0024h_00m_00.00s  restart_file_01_nemsio
cp _RTPWD_/NMMB_reg/GWD_bin_01 .
cp _RTPWD_/NMMB_reg/boco.* .
_CPPCP_cp ../NMM_REG_CTL/fort.4* .

cp $SRCDIR/job/regression_tests/atmos.configure_nmm atmos.configure
cp $SRCDIR/job/regression_tests/configure_file_01 .
cp configure_file_01 model_configure
cp _RTPWD_/data/* .
ln -sf global_o3prdlos.f77 fort.28
ln -sf global_o3clim.txt fort.48

cp $SRCDIR/job/regression_tests/dyn_state.txt .
cp $SRCDIR/job/regression_tests/phy_state.txt .
cp $SRCDIR/job/regression_tests/moving_nest_shift_*.txt .
_TS_cp $SRCDIR/job/regression_tests/ts_locations.nml .

#for post
_POST_export PGBOUT=nmm_pgb
_POST_export IGEN=82
_POST_cat <<EOF >postgp.inp.nml$$
_POST_ &NAMPGB
_POST_ $POSTGPVARS
_POST_  /
_POST_EOF
_POST_cp ${SRCDIR}/job/regression_tests/nmmb_cntrl.parm ./nmmb_cntrl.parm
_POST_ln -sf ./nmmb_cntrl.parm fort.14
_POST_ln -sf griddef.out fort.110
_POST_cp /nwprod/parm/nam_micro_lookup.dat ./eta_micro_lookup.dat


cp $SRCDIR/exe/NEMS.x .

if [ $SCHEDULER = 'loadleveler' ]; then
  cp $SRCDIR/job/regression_tests/nmm_ll .
  llsubmit nmm_ll 2>&1 | grep submitted > /dev/null
elif [ $SCHEDULER = 'moab' ]; then
  cp $SRCDIR/job/regression_tests/nmm_msub .
  msub nmm_msub > /dev/null
elif [ $SCHEDULER = 'pbs' ]; then
  cp $SRCDIR/job/regression_tests/nmm_qsub .
  qsub nmm_qsub > /dev/null
fi

exit
