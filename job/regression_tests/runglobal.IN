#!/bin/ksh
#
#@ output = out
#@ error = err
#@ job_type = parallel
#@ task_affinity = core(1)
#@ node_usage = shared
#@ tasks_per_node = _TPN_
#@ node = 1
#@ node_resources= ConsumableMemory(20GB)
#@ class = dev
#@ wall_clock_limit = 00:08:00
#@ parallel_threads = 1
#@ preferences = Feature == "dev"
#@ network.MPI = sn_all,shared,us
#@ account_no=NAM-T2O
#@ queue
#
set -x
#
export BIND_TASKS=yes
export MP_EAGER_LIMIT=65536
export MP_SHARED_MEMORY=yes
export MP_SINGLE_THREAD=yes
export TARGET_CPU_RANGE=-1
export OMP_MAX_THREADS=1
export MP_LABELIO=yes
export MP_STDOUTMODE=ordered
export MP_COREFILE_FORMAT=core.txt
export TARGET_CPU_RANGE="-1"
export XLSMPOPTS=parthds=1:spins=0:yields=0:stack=128000000:schedule=static
export AIXTHREAD_SCOPE=S

RUNDIR=/ptmp/_ME_/RT/_DIR_
SRCDIR=_SRCD_

mkdir -p $RUNDIR
cd $RUNDIR
rm -rf $RUNDIR/*

cp /meso/noscrub/wx20rv/REGRESSION_TEST/NMMB_glob/test_input_umo_global          main_input_filename
cp /meso/noscrub/wx20rv/REGRESSION_TEST/NMMB_glob/test_input_umo_global.nemsio   main_input_filename_nemsio
cp /meso/noscrub/wx20rv/REGRESSION_TEST/NMMB_glob/nmm_b_restart.024              restart_file
_GS_cp ../NMM_CNTRL/global_* .

cp $SRCDIR/job/regression_tests/configfile_global configure_file
cp /meso/noscrub/wx20rv/REGRESSION_TEST/data/* .

echo "Model started:  " `date`

LDR_CNTRL=DATAPSIZE=64K@TEXTPSIZE=64K@STACKPSIZE=64K \
poe $SRCDIR/exe/NMM_NEMS.x

echo "Model ended:    " `date`

exit
