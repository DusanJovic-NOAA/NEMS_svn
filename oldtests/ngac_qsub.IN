#! /bin/sh -l

#PBS -o @[RUND]/out
#PBS -e @[RUND]/err

#PBS -N @[JBNME]
#PBS -A @[ACCNR]
#PBS -q @[QUEUE]
#PBS -l procs=@[TASKS]
#PBS -l walltime=00:@[WLCLK]:00
#PBS -V

if [[ -e  @[PATHTR]/src/conf/modules.nems ]]; then
  source @[PATHTR]/src/conf/modules.nems
  module list
fi

set -ax
export MPI_GROUP_MAX=96
export MACHINE_ID=@[MACHINE_ID]
export SCHEDULER=@[SCHED]

cd @[RUND]

echo "Model started:  " `date`

export TASKSIZE=@[TASKS]
export NTHREADS=@[THRDS]

export NEMSIO_IN=@[NEMSIOIN]
export NEMSIO_OUT=@[NEMSIOOUT]

export OMP_NUM_THREADS=$NTHREADS
if [ $MACHINE_ID = 'theia' ]; then
 module purge
 module load intel/15.1.133 impi/5.0.3.048 netcdf/4.3.0 szip
 mpiexec=`which mpirun`
fi
if [ $NTHREADS -eq 1 ] ; then
 export FCST_LAUNCHER="$mpiexec -n $TASKSIZE"
else
 export FCST_LAUNCHER="$mpiexec -np $TASKSIZE"
fi

### for ngac
export RUN_ENVIR=dev 
export cyc=00 
export envir=dev
export PARA_CONFIG=@[CONFIG]
export CONFIG_FILE=@[CONFIGFILE]
export NEMSDIR=@[NEMSDIR]
export WORKDIR=@[WORKDIR]
export REGSDIR=@[REGSDIR] 
export FCST_SCRIPT_DIR=@[NEMSDIR]/oldtests
export DATAICDIR=@[DATAICDIR]
export PDY=20120717

export FHSWR=3600.
export FHLWR=3600.

export GRDI=@[REGSDIR]/$DATAICDIR/ngac.t00z.gfsanl
if [ $NEMSIO_IN = .true. ] ; then
  export SFCI=@[REGSDIR]/$DATAICDIR/ngac.t00z.sfnanl
else
  export SFCI=@[REGSDIR]/$DATAICDIR/ngac.t00z.sfcanl
fi

export wgrib=/home/George.Vandenberghe/nwprod/util/exec/wgrib
if [ $MACHINE_ID = 'theia' ]; then
  export HOMEGLOBAL=/scratch4/NCEPDEV/global/save/Shrinivas.Moorthi/para
  export FIXGLOBAL=/scratch4/NCEPDEV/global/save/Shrinivas.Moorthi/para/fix/fix_am
  export FIX_NGAC=/scratch4/NCEPDEV/global/save/Shrinivas.Moorthi/para/fix/fix_ngac
fi


@[RUND]/JNGAC_FORECAST.sms.para

echo "Model ended:    " `date`

exit
