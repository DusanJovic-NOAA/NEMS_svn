#!/bin/sh

#BSUB -o out
#BSUB -e err
#BSUB -J @[JBNME]
#BSUB -q @[QUEUE]
#BSUB -P @[ACCNR]
#BSUB -n @[TASKS]
#BSUB -x
#BSUB -W 00:@[WLCLK]

source @[SRCD]/src/conf/modules.nems
module list

 export KMP_STACKSIZE=1024m
 export OMP_NUM_THREADS=@[THRD]
 export MP_MPILIB=mpich2
 export MP_EUILIB=us
 export MP_TASK_AFFINITY=core:@[THRD]
 export MP_LABELIO=yes
 export MP_STDOUTMODE=unordered
 export MP_COREFILE_FORMAT=lite
#export LSB_PJL_TASK_GEOMETRY="`/u/James.A.Abeles/bin/mktjv 1536/16 12/4 768/16`"
 export LD_PRELOAD=/u/James.A.Abeles/mpi_trace_linux_x86_64/shared/libmpitrace.so

echo "Model started:  " `date`

mpirun.lsf ./NEMS.x

echo "Model ended:    " `date`

exit
