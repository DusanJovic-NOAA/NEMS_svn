#!/bin/bash
#BSUB -a poe
#BSUB -oo @[RUND]/out
#BSUB -eo @[RUND]/err
#BSUB -J @[JBNME]
#BSUB -network type=sn_all:mode=US
#BSUB -P GFS-T2O
####BSUB -P "@[ACCNR]"
#BSUB -q @[CLASS]
#BSUB -n @[TASKS]
#BSUB -R span[ptile=@[TPN]]
#BSUB -R affinity[core(@[THRDS])]
#BSUB -x
#BSUB -W 00:@[WLCLK]

source /usrx/local/Modules/default/init/ksh
source @[PATHTR]/src/conf/modules.nems
module list

 export FCST_LAUNCHER=mpirun.lsf
 export OMP_NUM_THREADS=@[THRDS]
 export MP_MPILIB=mpich2
 export MP_EUIDEVELOP=min
 export KMP_STACKSIZE=1024m
 export MP_LABELIO=yes
 export MP_STDOUTMODE=ordered
 export LD_PRELOAD=/u/James.A.Abeles/mpi_trace_linux_x86_64/shared/libmpitrace.so
 export KMP_STACKSIZE=1024m

set -x

echo "Model started:  " `date`

export MACHINE_ID=@[MACHINE_ID]
export SCHEDULER=@[SCHED]
cd @[RUND]

export NEMSIO_IN=@[NEMSIOIN]
export NEMSIO_OUT=@[NEMSIOOUT]

##mpirun.lsf ./NEMS.x
export RUN_ENVIR=dev
export cyc=00
export envir=dev
export PARA_CONFIG=@[CONFIG]
export CONFIG_FILE=@[CONFIGFILE]
export NEMSDIR=@[NEMSDIR]
export WORKDIR=@[WORKDIR]
export REGSDIR=@[REGSDIR]
export FCST_SCRIPT_DIR=@[NEMSDIR]/tests
export DATAICDIR=@[DATAICDIR]
export PDY=20120717

export GRDI=@[REGSDIR]/$DATAICDIR/ngac.t00z.gfsanl

if [ $NEMSIO_IN = .true. ] ; then
  export SFCI=@[REGSDIR]/$DATAICDIR/ngac.t00z.sfnanl
else
  export SFCI=@[REGSDIR]/$DATAICDIR/ngac.t00z.sfcanl
fi

export FIXGLOBAL=/global/noscrub/Shrinivas.Moorthi/para_new/para/fix/fix_am

@[RUND]/JNGAC_FORECAST.sms.para

echo "Model ended:    " `date`

exit
