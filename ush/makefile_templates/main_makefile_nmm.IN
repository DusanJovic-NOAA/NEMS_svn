####   requires necessary grid components
#
#
# *****************************************************************
#
include ../../ush/compile_settings
all: 
	_GFS_PHYSICS_
	cd $(NMM_UTIL) && gmake
	cd $(NMM_IO) && gmake 
	cd $(NMM_DYN) && gmake  
	cd $(NMM_PHY) && gmake 
	cd $(GOCART) && export ESMADIR=`pwd` && gmake -C src install GOCART_MODE=$(GOCART_MODE)
	cd $(ATM) && gmake
	/bin/rm -f $(EXEDIR)/NMM_NEMS.x
	$(CPP) $(CPPFLAGS) $(ROOT).F90 > $(ROOT).f90
	$(F90) $(FFLAG_NMM_MAIN) -c $(ROOT).f90
	$(LDR) $(LDFLAGS) -o ${EXEDIR}/NMM_NEMS.x $(OBJS) $(LIB)
	echo "NMM_NEMS.x is created for NMM core."

clean:
	_GFS_PHYSICS_ clean
	cd $(NMM_UTIL) && gmake clean
	cd $(NMM_IO) && gmake clean 
	cd $(NMM_DYN) && gmake clean
	cd $(NMM_PHY) && gmake clean
	cd $(GOCART) && export ESMADIR=`pwd` && gmake -C src realclean GOCART_MODE=$(GOCART_MODE)
	cd $(ATM) && gmake clean
	/bin/rm -f $(EXEDIR)/NMM_NEMS.x
	/bin/rm -f *.o
	/bin/rm -f *.mod
	/bin/rm -f *.f90
	/bin/rm -f *.lst
	/bin/rm -f lm
	/bin/rm -f map
	/bin/rm -f $(JOBDIR)/regression_tests/*.log*
	/bin/rm -f $(USHDIR)/makefile_templates/main_makefile_nmm
	/bin/rm -f $(USHDIR)/compile_settings
	echo "directories cleaned."
