#############################################
How to run NMMB tests:
#############################################

We run 4 tests using the NMMB dynamical core for 
both global and regional domains and 4 tests using
the GFS dynamical core:

NMM

0) 6 processors, no threads, 1 node, cold start
1) 15 processors, no threads, 1 node, cold start
2) 15 processors, 2 threads, 2 nodes, cold start
3) 45 processors, no threads, 3 nodes, cold start
4) 15 processors, no threads, 1 node, initialized from restart.

GFS

0) 1 processors, no threads, 1 node, cold start
1) 15 processors, no threads, 1 node, cold start
2) 15 processors, 2 threads, 2 nodes, cold start
3) 45 processors, no threads, 3 nodes, cold start


---------------------------------------------
0) 0-Run (minimal processors)

*** file run_nmmb:

set number of processors/node and nodes:
#@ tasks_per_node = (6 for NMM & 1 for GFS) 
#@ node = 1

be sure that these environment variables are set:
export BIND_TASKS=no
export XLSMPOPTS="parthds=1:stack=128000000"

*** file configfile_global_new:

set numbers of processors:
inpes:  02
jnpes:  02

set number of I/O processors:
write_groups:          1
write_tasks_per_group: 2

set read/write global summation arguments:
read_global_sums:  false
write_global_sums: false 


1) First run (control).

*** file run_nmmb:

set number of processors/node and nodes:
#@ tasks_per_node = 16
#@ node = 1

be sure that these environment variables are set:
export BIND_TASKS=no
export XLSMPOPTS="parthds=1:stack=128000000"

*** file configfile_global_new:

set numbers of processors:
inpes:  03
jnpes:  05

set number of I/O processors:
write_groups:          1
write_tasks_per_group: 1

set read/write global summation arguments:
read_global_sums:  false
write_global_sums: true

---------------------------------------------
Save results and run second and third test:
---------------------------------------------

2) Second run.

*** file run_nmmb:

set number of processors/node and nodes:
#@ tasks_per_node = 8
#@ node = 2

be sure that these environment variables are set:
export BIND_TASKS=yes
export XLSMPOPTS="parthds=2:stack=128000000"

*** file configfile_global_new:

set numbers of processors:
inpes:  03
jnpes:  05

set number of I/O processors:
write_groups:          1
write_tasks_per_group: 1

set read/write global summation arguments:
read_global_sums:  true
write_global_sums: false

---------------------------------------------
Compare results with control run.
---------------------------------------------

3) Third run.

*** file run_nmmb:

set number of processors/node and nodes:
#@ tasks_per_node = 16
#@ node = 3

be sure that these environment variables are set:
export BIND_TASKS=no
export XLSMPOPTS="parthds=1:stack=128000000"

*** file configfile_global_new:

set numbers of processors:
inpes:  09
jnpes:  05

set number of I/O processors:
write_groups:          1
write_tasks_per_group: 3

set read/write global summation arguments:
read_global_sums:  true
write_global_sums: false

4) Fourth run. (NMM ONLY)

set number of processors/node and nodes:
#@ tasks_per_node = 16
#@ node = 1

be sure that these environment variables are set:
export BIND_TASKS=no
export XLSMPOPTS="parthds=1:stack=128000000"

cp nmm_b_restart.xx restart_file

*** file configfile_global_new:

set numbers of processors:
inpes:  03
jnpes:  05

set number of I/O processors:
write_groups:          1
write_tasks_per_group: 1

set read/write global summation arguments:
read_global_sums:  true
write_global_sums: false


---------------------------------------------
Compare results with control run.
---------------------------------------------

NOTE 1:
When finished with tests, set 'read_global_sums:'
and 'write_global_sums:' arguments back to false. 
They are used ONLY for tests to check bit-identical 
reproducibility.

NOTE 2:
Turn off traps when performing these tests because
there is some conflict between traps and threads.
---------------------------------------------

#############################################
#############################################


NMM-B Experiment (Global)
Duration: 00Z 09182007  - 00Z 09202007
Domain: IM,JM,KM = 257, 181,35
Grid Decomposition: 
inpes: 03, 05
jnpes: 05, 09
Timestep: 180 s

GFS Experiment
Duration: 00Z 07022007 - 00Z 07042007
LONB=192,LATB=94,
LEVS=64
Grid Decomposition: 
inpes: 01
jnpes: 16
Timestep: 900 s

Test 0:
        Nodes: 1
        Tasks: 4 + 2(write)
        Threading: None
        Duration: 48 hours

Test 1:

	Nodes: 1
   	Tasks: 15 + 1(write)
	Threading: None
	Duration: 48 hours

Test 2:

	Nodes: 2
	Tasks:  15 + 1 (write)
	Threading: 2
	Duration: 48 hours

Test 3:

	Nodes: 3
	Tasks: 45+3 (write)
	Threading: None
	Duration: 48 hours

Test 4:

        Nodes: 1
        Tasks: 15+1 (write)
        Threading: None
        Duration: 24 hours (starting from the 24th hour of Test 1 restart file)


Results
        NMM-B: 		        GFS:
0)      PASS                    PASS (1 processor) 
I) 	Pass			Pass
II)  	Pass			Pass
III) 	Pass			Pass
IV)     Pass                    -

		
