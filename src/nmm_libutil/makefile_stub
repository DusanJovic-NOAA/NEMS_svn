################################################################################
# 
#     Makefile for Global NMM Model 
#
#     Use:
#     make         -  build the executable
#     make clean   -  start with a clean slate
#
#     The following macros will be of interest:
#
#         TARGET   - name of the executable
#         FC       - name of Fortran compiler
#         CPP      - name of CPP
#         ARCH     - architecture
#         CPPFLAGS - CPP flags
#         OPTS     - compiler code optimizations
#         LIST     - source listing
#         SMP      - threading
#         TRAPS    - runtime traps for floating point exceptions
#         PROFILE  - source code profiling ( -pg )
#         DEBUG    - -g
#         MEM      - user data area and stack size
#         MAP      - load map
#         W3LIB    - w3lib
#         ESSL     - ESSL library
#         MASS     - MASS library
#         TRACE    - MPI tracing
#
#################################################################################
#
# Define the name of the executable
#
#
# CPP, Compiler, and Linker Options
#
TARGET     = nmm_libutil_stub.a
UTIL     = nmm_libutil
FC       = xlf
PROF     = -g -pg
PROF     =
ARCH     = AIX
CPP      = /lib/cpp -P
CPPFLAGS = -DENABLE_SMP -DIBM
OPTS     = -O2 -qmaxmem=-1 -qarch=auto -qtune=auto $(PROF) -NS2000
#TRAPS    = -qinitauto=FF911299 -qflttrap=ov:zero:inv:en -qsigtrap -C
TRAPS    = 
#
# Assemble Options
#
FINCO    = -I/climate/save/${USER}/esmf/nems/trunk_merge_gfswrt/trunk/mod/esmf_3_1_0rp2
FINCP    = -I/climate/save/${USER}/esmf/nems/trunk_merge_gfswrt/trunk/lib/w3_d  
FINCS	 = $(FINCO) $(FINCP)
FFLAGS   = $(OPTS) $(FINCS) $(TRAPS)
#

MODULES=	\
		module_ATM_INTERNAL_STATE.o  \
		module_CLOCKTIMES.o \
		module_CONSTANTS.o \
		module_CONTROL.o \
		module_DIAGNOSE.o \
		module_DM_PARALLEL.o \
		module_EXCHANGE.o \
		module_INCLUDE.o \
		module_DIGITAL_FILTER_NMM.o \
		module_ERR_MSG.o \
		looplimits.o

INCLUDES=	../../inc/kind.inc

DEPS= $(INCLUDES)

AR = ar
ARFLAGS = -r


.SUFFIXES:	.F90 .f90 .o

.F90.f90:
	$(CPP) $(CPPFLAGS) $< > $*.f90

$(TARGET): $(MODULES) 
	$(AR) $(ARFLAGS) $(TARGET) $(MODULES) 

$(MODULES):	$(DEPS)
	$(FC) $(FFLAGS) -c $<

clean:	
	/bin/rm -f  $(TARGET) *.f90 *.lst *.o *.mod lm map

#
# DEPENDENCIES :
#
module_CONTROL.o :      module_INCLUDE.o \
                        module_CONSTANTS.o \
                        module_DM_PARALLEL.o \
                        module_EXCHANGE.o

module_DIGITAL_FILTER_NMM.o: module_INCLUDE.o \
			     module_DM_PARALLEL.o

module_EXCHANGE.o :     module_INCLUDE.o \
                        module_DM_PARALLEL.o

module_DM_PARALLEL.o :  module_INCLUDE.o

module_CONSTANTS.o :    module_INCLUDE.o
