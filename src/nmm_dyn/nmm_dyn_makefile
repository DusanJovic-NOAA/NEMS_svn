################################################################################
# 
#     Makefile for Global NMM Model 
#
#     Use:
#     make         -  build the executable
#     make clean   -  start with a clean slate
#
#     The following macros will be of interest:
#
#         TARGET   - name of the executable
#         FC       - name of Fortran compiler
#         CPP      - name of CPP
#         ARCH     - architecture
#         CPPFLAGS - CPP flags
#         OPTS     - compiler code optimizations
#         LIST     - source listing
#         SMP      - threading
#         TRAPS    - runtime traps for floating point exceptions
#         PROFILE  - source code profiling ( -pg )
#         DEBUG    - -g
#         MEM      - user data area and stack size
#         MAP      - load map
#         W3LIB    - w3lib
#         ESSL     - ESSL library
#         MASS     - MASS library
#         TRACE    - MPI tracing
#
#################################################################################
#
# Define the name of the executable
#
#
# CPP, Compiler, and Linker Options
#
include ../../ush/compile_settings
MAKEFILE=nmm_dyn_makefile
TARGET= nmm_dyn.a
#

MODULES=	\
		module_DYNAMICS_FIELDS.o \
		module_DYNAMICS_OUTPUT.o \
		module_DYN_PHY_CPL_COMP.o \
		module_DYN_PHY_CPL_DATA.o \
		module_GET_CONFIG_DYN.o \
		module_DYNAMICS_INIT_READ.o

MODULE_DGC=	\
		module_DYNAMICS_GRID_COMP.o

MODULE_SMP=     \
		module_DYNAMICS_INTERNAL_STATE.o \
		module_DYNAMICS_ROUTINES.o \
                module_FLTBNDS.o

.SUFFIXES:	.F90 .f90 .o

.F90.f90:
	$(CPP) $(CPPFLAGS) $< > $*.f90

default:
	@gmake -f $(MAKEFILE) all

all: $(LIBDIR)/lib/$(TARGET)


$(LIBDIR)/lib/$(TARGET): $(MODULES) $(MODULE_DGC) $(MODULE_SMP) $(MODULE_SMP1)
	$(AR) $(ARFLAGS) $@ $?

$(MODULES): %.o: %.f90 $(DEPS)
	$(FC) $(FFLAG_NMM_DYN) -c $*.f90

$(MODULE_DGC): %.o: %.f90 $(DEPS)
	$(FC) $(FFLAG_NMM_DYN) -c $*.f90

$(MODULE_SMP): %.o: %.f90  $(DEPS)
	$(FC) $(FFLAG_NMM_DYN) $(SMP) $(MAF) -c $*.f90

clean:	
	/bin/rm -f $(LIBDIR)/lib/$(TARGET) 
	/bin/rm -f *.f90 
	/bin/rm -f *.lst 
	/bin/rm -f *.o 
	/bin/rm -f *.mod 
	/bin/rm -f lm 
	/bin/rm -f map
#
# DEPENDENCIES :
#
 
module_DYN_PHY_CPL_COMP.o:	\
			  	module_DYNAMICS_GRID_COMP.o \
			  	module_DYN_PHY_CPL_DATA.o 

module_DYNAMICS_GRID_COMP.o:	\
			   	module_FLTBNDS.o \
			   	module_GET_CONFIG_DYN.o \
			   	module_DYNAMICS_INTERNAL_STATE.o \
			   	module_DYNAMICS_FIELDS.o \
			   	module_DYNAMICS_OUTPUT.o \
			   	module_DYNAMICS_ROUTINES.o \
				module_DYNAMICS_INIT_READ.o

module_GET_CONFIG_DYN.o:     \
				module_DYNAMICS_INTERNAL_STATE.o

module_DYNAMICS_FIELDS.o:	\
				module_DYNAMICS_INTERNAL_STATE.o


module_DYNAMICS_OUTPUT.o:    \
				module_DYNAMICS_INTERNAL_STATE.o 

module_DYNAMICS_INTERNAL_STATE.o:	\
			 	module_FLTBNDS.o
