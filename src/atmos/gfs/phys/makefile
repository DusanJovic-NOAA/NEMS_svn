include ../../../conf/configure.nems

MAKEFILE = makefile

UTILINCS = -I../../share -I../libutil
GOCARTINCS = -I../../../chem/gocart/AIX/include/Chem_Base \
             -I../../../chem/gocart/AIX/include/GMAO_mpeu \
             -I../../../chem/gocart/AIX/include/GEOSchem_GridComp


LIBRARY   = gfs_physics.a

#DEBUG    = -qcheck -qsource -qlist
#FFLAGM_DEBUG  = -O0 -qcheck
FFLAGM_DEBUG  = -O3
OPTS     = -qsuffix=cpp=f -qrealsize=8 -qstrict -qxlf77=leadzero -qmaxmem=-1 -qnolm -qsmp=noauto  -qnosave $(FFLAGM_DEBUG)

FFLAG90  = $(FFLAGS) $(OPTS) -qfree -NS2048 $(UTILINCS)
FFLAGS1  = $(FFLAGS) $(OPTS) $(TRAPS) -qfixed $(UTILINCS) $(GOCARTINCS)
FFLAGIO  = $(OPTS) $(TRAPS) -qfixed
FFLAGM   = $(OPTS) $(FINCS) -qfixed $(TRAPS) $(FFLAGM_DEBUG) -NS2048
FFLAGM3  = $(OPTS) $(FINCS) -qfree  $(TRAPS) $(DEBUG) -NS2048
FFLAGSF=-qnosave -q free=f90 -qcheck $(FFLAGM_DEBUG)
FFLAGSI  = -qrealsize=8 -qnosave -q free=f90 $(FFLAGM_DEBUG)
FFLAGSDB = $(FFLAGS1)
FFLAG_GFS_PHY=$(OPTS) $(TRAPS) -qfixed    $(UTILINCS) $(GOCARTINCS)
FFLAG_GFS_PHY90=$(FFLAG90) $(TRAPS)     $(UTILINCS) $(GOCARTINCS)


OBJS0   = \
	  gfs_physics_err_msg_mod.o            \
	  gfs_physics_sfc_flx_mod.o	       \
	  gfs_physics_nst_var_mod.o            \
	  gfs_physics_sfc_flx_set_mod.o	       \
	  gfs_physics_gridgr_mod.o             \
	  gfs_physics_g2d_mod.o                \
	  gfs_physics_g3d_mod.o      	       \
	  gfs_physics_namelist_mod.o           \
	  gfs_physics_start_time_get_mod.o     \
	  gfs_physics_internal_state_mod.o     \
	  gfs_physics_grid_create_mod.o        \
	  gfs_physics_output.o                 \
	  gfs_physics_getcf_mod.o              \
 	  gfs_physics_initialize_mod.o         \
	  gfs_physics_run_mod.o                \
	  gfs_physics_finalize_mod.o           \
	  gfs_physics_add_get_state_ESMFField_mod.o      \
	  gfs_phy_states_mod.o             \
	  gfs_physics_grid_comp_mod.o

OBJ_MOD	= \
	  machine.o 	  	    \
	  iounitdef.o               \
	  resol_def.o               \
	  layout1.o                 \
	  vert_def.o                \
	  gg_def.o                  \
	  date_def.o                \
	  physcons.o                \
	  funcphys.o                \
	  progtm_module.o           \
	  rascnvv2.o                \
	  namelist_physics_def.o    \
	  namelist_soilveg.o        \
	  coordinate_def.o          \
	  tracer_const_h.o  	    \
	  gfs_phy_tracer_config.o   \
	  reduce_lons_grid_module.o \
	  module_bfmicrophysics.o   \
	  mersenne_twister.o  	    \
	  mpi_def.o		    \
	  d3d_def.o        	    \
	  sfcio_module.o            \
          mod_state.o               \
	  nstio_module.o            \
	  module_nst_parameters.o   \
	  module_nst_water_prop.o   \
	  module_nst_model.o        \
	  calpreciptype.o

OBJS    = \
          glats_physics.o               \
          getcon_physics.o              \
          lon_lat_para.o                \
          compns_physics.o              \
          info.o                        \
          mymaxmin.o                    \
          lats_shuff.o                  \
          setlats.o                     \
          coundummy.o                   \
          sortrx.o                      \
          mpi_quit.o                    \
          get_lats_node_shuff_r_fix.o   \
          do_physics_one_step.o         \
          gcycle.o                      \
          hpmdummy.o

#          common_to_physics_vars.o      \
#          physics_to_common_vars.o      \

OBJS_IO= \
	  fix_fields.o       \
	  read_fix.o         \
	  GFS_simple_scatter.o \
	  wrtout_physics.o   \
	  gribit.o           \
	  fld_collect.o      \
	  fld_collect_nst.o      \
	  para_fixio_w.o     \
	  para_nst_w.o     \
	  sfcsub.o

OBJS_RAD	=              \
	radlw_param.o          \
	radlw_datatb.o         \
	radlw_main.o           \
	radsw_param.o          \
	radsw_datatb.o         \
	radsw_main.o           \
	radiation_astronomy.o  \
	radiation_aerosols.o   \
	radiation_gases.o      \
	radiation_clouds.o     \
	radiation_surface.o    \
	grrad.o                \
	gloopr.o


OBJS_PHY = \
	ozinterp.o            \
	ozphys.o              \
	gloopb.o              \
	gbphys.o              \
	gbphys_adv_hyb_gc.o   \
	gbphys_adv_hyb_gc_h.o \
	dcyc2.o               \
	dcyc2.pre.rad.o       \
	set_soilveg.o         \
	sfc_drv.o             \
	sfc_land.o            \
	progt2.o              \
	sfc_sice.o            \
	sfc_ocean.o           \
	sfc_nst.o             \
	sfc_diff.o            \
	sfc_diag.o            \
	sflx.o                \
	moninp.o              \
	moninp1.o             \
	moninq.o              \
	gwdps.o               \
	gwdc.o                \
	sascnv.o              \
	sascnvn.o             \
	cnvc90.o              \
	shalcv.o              \
	shalcv_opr.o          \
	shalcnv.o             \
	lrgsclr.o             \
	gscond.o              \
	precpd.o              \
	mstadb.o              \
	mstadbtn.o            \
	mstcnv.o              \
	get_prs.o             \
	gsmddrive.o 

OBJS_CC=            \
	mpi_more.o  \
	cmp.comm.o  \
	atm.comm.o  \
	tiles.o

#
# *****************************************************************
#

DEPEND_FILES = ${OBJS0:.o=.f} ${OBJ_MOD:.o=.f} ${OBJS:.o=.f} ${OBJS_IO:.o=.f} ${OBJS_RAD:.o=.f} ${OBJS_PHY:.o=.f} $(OBJS_CC:.o=.f)

all default: depend
	@gmake -f $(MAKEFILE) $(LIBRARY)

$(LIBRARY):  $(OBJ_MOD) $(OBJS_CC) $(OBJS0) $(OBJS) $(OBJS_RAD) $(OBJS_PHY) $(OBJS_IO)
	$(AR) $(ARFLAGS) $@ $?

.f.o: %.o: %.f
	$(F77) $(FFLAGS1) -c $*.f

clean:
	$(RM) -f $(LIBRARY) *.o *.mod *.lst lm map depend

#
# *****************************************************************
#

cnvc90.o:	cnvc90.f
		$(F77) $(FFLAGM) -c cnvc90.f

calpreciptype.o:	calpreciptype.f
		$(F77) $(FFLAGM3) -c calpreciptype.f

dcyc2.o:	dcyc2.f
		$(F77) $(FFLAGM) -c dcyc2.f

dcyc2.pre.rad.o:	dcyc2.pre.rad.f
		$(F77) $(FFLAGM) -c dcyc2.pre.rad.f

funcphys_subsx.o:	funcphys_subsx.f
		$(F77) $(FFLAGM) -c funcphys_subsx.f

gbphys_adv_hyb_gc.o:	gbphys_adv_hyb_gc.f
		$(F77) $(FFLAGM) -c gbphys_adv_hyb_gc.f

gbphys_adv_hyb_gc_h.o:	gbphys_adv_hyb_gc_h.f
		$(F77) $(FFLAGM) -c gbphys_adv_hyb_gc_h.f

gbphys.o:	gbphys.f
		$(F77) $(FFLAGM) -c gbphys.f

get_prs.o:	get_prs.f
		$(F77) $(FFLAGM) -c get_prs.f

gscond.o:	gscond.f
		$(F77) $(FFLAGM) -c gscond.f

gsmddrive.o:	gsmddrive.f
		$(F77) $(FFLAGM) -c gsmddrive.f

module_bfmicrophysics.o:	module_bfmicrophysics.f
		$(F77) $(FFLAGM) -c module_bfmicrophysics.f

gwdps.o:	gwdps.f
		$(F77) $(FFLAGM) -c gwdps.f

gwdc.o:		gwdc.f
		$(F77) $(FFLAGM) -c gwdc.f

lrgsclr.o:	lrgsclr.f
		$(F77) $(FFLAGM) -c lrgsclr.f

moninp.o:	moninp.f
		$(F77) $(FFLAGM) -c moninp.f

moninp1.o:	moninp1.f
		$(F77) $(FFLAGM) -c moninp1.f

moninq.o:	moninq.f
		$(F77) $(FFLAGM) -c moninq.f

mstadb.o:	mstadb.f
		$(F77) $(FFLAGM) -c mstadb.f

mstadbtn.o:	mstadbtn.f
		$(F77) $(FFLAGM) -c mstadbtn.f

mstcnv.o:	mstcnv.f
		$(F77) $(FFLAGM) -c mstcnv.f

ozinterp.o:	ozinterp.f
		$(F77) $(FFLAGM) -c ozinterp.f

ozphys.o:	ozphys.f
		$(F77) $(FFLAGM) -c ozphys.f

precpd.o:	precpd.f
		$(F77) $(FFLAGM) -c precpd.f

rascnvv2.o:	rascnvv2.f
		$(F77) $(FFLAGM) -c rascnvv2.f

sfc_sice.o:	sfc_sice.f
		$(F77) $(FFLAGM) -c sfc_sice.f

set_soilveg.o:	set_soilveg.f
		$(F77) $(FFLAGM) -c set_soilveg.f

namelist_soilveg.o:	namelist_soilveg.f
		$(F77) $(FFLAGM) -c namelist_soilveg.f

sfc_land.o:	sfc_land.f
		$(F77) $(FFLAGM) -c sfc_land.f
                                                                            
progt2.o:	progt2.f
		$(F77) $(FFLAGM) -c progt2.f

sfc_drv.o:	sfc_drv.f
		$(F77) $(FFLAGM) -c sfc_drv.f

sflx.o: 	sflx.f
		$(F77) $(FFLAGM) -c sflx.f

sfc_ocean.o:	sfc_ocean.f
		$(F77) $(FFLAGM) -c sfc_ocean.f
		$(F77) $(FFLAGM) -c sfc_ocean.f
sfc_nst.o:	sfc_nst.f
		$(F77) $(FFLAGM) -c sfc_nst.f

sfc_diff.o:	sfc_diff.f
		$(F77) $(FFLAGM) -c sfc_diff.f

sfc_diag.o:	sfc_diag.f
		$(F77) $(FFLAGM) -c sfc_diag.f

sascnv.o:	sascnv.f
		$(F77) $(FFLAGM) -c sascnv.f

sascnvn.o:	sascnvn.f
		$(F77) $(FFLAGM) -c sascnvn.f

shalcv_opr.o:	shalcv_opr.f
		$(F77) $(FFLAGM) -c shalcv_opr.f

shalcv.o:	shalcv.f
		$(F77) $(FFLAGM) -c shalcv.f

shalcnv.o:	shalcnv.f
		$(F77) $(FFLAGM) -c shalcnv.f

# *****************************************************************

radlw_param.o:	radlw_param.f
		$(F77) $(FFLAGM) -c radlw_param.f

radlw_datatb.o:	radlw_datatb.f
		$(F77) $(FFLAGM) -c radlw_datatb.f

radlw_main.o:	radlw_main.f
		$(F77) $(FFLAGM) -c radlw_main.f

radsw_param.o:	radsw_param.f
		$(F77) $(FFLAGM) -c radsw_param.f

radsw_datatb.o:	radsw_datatb.f
		$(F77) $(FFLAGM) -c radsw_datatb.f

radsw_main.o:	radsw_main.f
		$(F77) $(FFLAGM) -c radsw_main.f

radiation_astronomy.o:	radiation_astronomy.f
		$(F77) $(FFLAGM) -c radiation_astronomy.f

radiation_aerosols.o:	radiation_aerosols.f
		$(F77) $(FFLAGM) -c radiation_aerosols.f

radiation_gases.o:	radiation_gases.f
		$(F77) $(FFLAGM) -c radiation_gases.f

radiation_clouds.o:	radiation_clouds.f
		$(F77) $(FFLAGM) -c radiation_clouds.f

radiation_surface.o:	radiation_surface.f
		$(F77) $(FFLAGM) -c radiation_surface.f

grrad.o:	grrad.f
		$(F77) $(FFLAGM) -c grrad.f

progtm_module.o:	progtm_module.f
		$(F77) $(FFLAGM) -c progtm_module.f

machine.o:	machine.f
		$(F77) -qfixed -c machine.f

mpi_def.o:	mpi_def.f
		$(F77) $(FFLAG_GFS_PHY) -c mpi_def.f

#
# *****************************************************************
#
physcons.o:	physcons.f
		$(F77) $(FFLAG90) -c physcons.f

iounitdef.o:	iounitdef.f
		$(F77) $(FFLAG90) -c iounitdef.f

funcphys.o:	funcphys.f
		$(F77) $(FFLAG90) -c funcphys.f

sfcio_module.o:	sfcio_module.f
		$(F77) $(FFLAGSF) -c sfcio_module.f

sigio_module.o:	sigio_module.f
		$(F77) $(FFLAGSI) -c sigio_module.f

gfsio_def.o:	gfsio_def.f
		$(F77) $(FFLAGSI) -c gfsio_def.f

gfsio_module.o:	gfsio_module.f
		$(F77) $(FFLAGSI) -c gfsio_module.f

sigio_r_module.o:	sigio_r_module.f
		$(F77) $(FFLAGSI) -c sigio_r_module.f

gloopr.o:	gloopr.f
		$(F77) $(FFLAGS1) -c gloopr.f

gloopb.o:	gloopb.f
		$(F77) $(FFLAGM) -c gloopb.f

sfcsub.o:	sfcsub.f
		$(F77) $(FFLAGM) -c sfcsub.f

gcycle.o:	gcycle.f
		$(F77) $(FFLAGM) -c gcycle.f

getaer.o:	getaer.f
		$(F77) $(FFLAGIO) -c getaer.f

gribit.o:	gribit.f
		$(F77) $(FFLAGIO) -c gribit.f

fld_collect.o:  fld_collect.f
	        $(F77) $(FFLAG_GFS_PHY) -c fld_collect.f

fld_collect_nst.o:  fld_collect_nst.f
	        $(F77) $(FFLAG_GFS_PHY) -c fld_collect_nst.f

read_fix.o: read_fix.f
	        $(F77) $(FFLAG_GFS_PHY) -c read_fix.f

para_fixio_w.o:  para_fixio_w.f
		$(F77) $(FFLAG_GFS_PHY) -c para_fixio_w.f

para_nst_w.o:  para_nst_w.f
		$(F77) $(FFLAG_GFS_PHY) -c para_nst_w.f

mpi_more.o:	mpi_more.f
		$(F77) $(FFLAGxSM) -c mpi_more.f

cmp.comm.o:	cmp.comm.f
		$(F77) $(FFLAGM) -c cmp.comm.f

atm.comm.o:	atm.comm.f
		$(F77) $(FFLAGM) -c atm.comm.f

tiles.o:	tiles.f
		$(F77) $(FFLAGM) -c tiles.f

para_nstio_w.o:  para_nstio_w.f
		$(F77) $(FFLAG_GFS_PHY) -c para_nstio_w.f

wrtout_physics.o: wrtout_physics.f
		$(F77) $(FFLAG_GFS_PHY) -c wrtout_physics.f

nstio_module.o:	  nstio_module.f
		$(F77) $(FFLAG90) -c nstio_module.f

module_nst_parameters.o:	 module_nst_parameters.f
		$(F77) $(FFLAG90) -c module_nst_parameters.f

module_nst_water_prop.o:	module_nst_water_prop.f
		$(F77) $(FFLAG90) -c module_nst_water_prop.f

module_nst_model.o:	 module_nst_model.f
		$(F77) $(FFLAG90) -c module_nst_model.f

gfs_physics_err_msg_mod.o:      gfs_physics_err_msg_mod.f
		$(F77) $(FFLAG90) -c gfs_physics_err_msg_mod.f

gfs_physics_gridgr_mod.o:	gfs_physics_gridgr_mod.f
		$(F77) $(FFLAG90) -c gfs_physics_gridgr_mod.f

gfs_physics_g2d_mod.o:          gfs_physics_g2d_mod.f
		$(F77) $(FFLAG90) -c gfs_physics_g2d_mod.f

gfs_physics_g3d_mod.o:		gfs_physics_g3d_mod.f
		$(F77) $(FFLAG90) -c gfs_physics_g3d_mod.f

gfs_physics_sfc_flx_mod.o:      gfs_physics_sfc_flx_mod.f
		$(F77) $(FFLAG90) -c gfs_physics_sfc_flx_mod.f

gfs_physics_nst_var_mod.o:      gfs_physics_nst_var_mod.f
		$(F77) $(FFLAG90) -c gfs_physics_nst_var_mod.f
                                                                                
gfs_physics_sfc_flx_set_mod.o:      gfs_physics_sfc_flx_set_mod.f
		$(F77) $(FFLAG90) -c gfs_physics_sfc_flx_set_mod.f

gfs_physics_nst_flx_var.o:	gfs_physics_nst_var_mod.f
		$(F77) $(FFLAG90) -c gfs_physics_nst_var_mod.f
                                                                                
gfs_physics_namelist_mod.o:     gfs_physics_namelist_mod.f
		$(F77) $(FFLAG90) -c gfs_physics_namelist_mod.f
                                                                                
gfs_physics_start_time_get_mod.o:       gfs_physics_start_time_get_mod.f
		$(F77) $(FFLAG_GFS_PHY90) -c gfs_physics_start_time_get_mod.f
                                                                                
gfs_physics_grid_create_mod.o:  gfs_physics_grid_create_mod.f
		$(F77) $(FFLAG90) -c gfs_physics_grid_create_mod.f
                                                                                
gfs_physics_output.o:   gfs_physics_output.f
		$(F77) $(FFLAG90) -c gfs_physics_output.f

gfs_physics_getcf_mod.o:        gfs_physics_getcf_mod.f
		$(F77) $(FFLAG90) -c gfs_physics_getcf_mod.f
                
gfs_physics_internal_state_mod.o:       gfs_physics_internal_state_mod.f
		$(F77) $(FFLAG90) -c gfs_physics_internal_state_mod.f
                
gfs_physics_add_get_state_ESMFField_mod.o:        gfs_physics_add_get_state_ESMFField_mod.f
		$(F77) $(FFLAG90) -c gfs_physics_add_get_state_ESMFField_mod.f

gfs_phy_states_mod.o:		gfs_phy_states_mod.f
		$(F77) $(FFLAG90) -c gfs_phy_states_mod.f

gfs_physics_initialize_mod.o:   gfs_physics_initialize_mod.f
		$(F77) $(FFLAG90) -c gfs_physics_initialize_mod.f
                                                                                
gfs_physics_run_mod.o:  gfs_physics_run_mod.f
		$(F77) $(FFLAG90) -c gfs_physics_run_mod.f
                                                                                
gfs_physics_finalize_mod.o:     gfs_physics_finalize_mod.f
		$(F77) $(FFLAG90) -c gfs_physics_finalize_mod.f
                                                                                
gfs_physics_grid_comp_mod.o:    gfs_physics_grid_comp_mod.f
		$(F77) $(FFLAG90) -c gfs_physics_grid_comp_mod.f

### use FFLAGSDB compile option
gfs_phy_tracer_config.o:	gfs_phy_tracer_config.f
		$(F77)  $(FFLAGSDB) -c gfs_phy_tracer_config.f

#
#
#

include ../../../conf/make.rules

include depend
